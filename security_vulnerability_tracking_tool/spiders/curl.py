# -*- coding: utf-8 -*-
import scrapy
import re
import pandas as pd
from pandas import ExcelWriter

class CurlSpider(scrapy.Spider):
    name = 'curl'
    allowed_domains = ['curl.haxx.se/docs/security.html']
    start_urls = ['https://curl.haxx.se/docs/security.html']

    def parse(self, response):
        #impact_Rating = response.xpath('//table/tbody/tr/td[2]/a/text()').extract()
        date = response.xpath('//tr/td[3]/text()').extract()
        advisory =  response.xpath('//tr/td[2]/a/text()').extract()
        cve_Id  = response.xpath('//tr/td[6]').extract()
        versions_Affected  =response.xpath('//tr/td[4]/a/text()').extract()
        versions_Affected2 =response.xpath('//tr/td[5]/a/text()').extract()
        cwe = response.xpath('//tr/td[7]/a/text()').extract()

        try:
            data = {"date":date,"advisory":advisory,"cve_Id":cve_Id,"versions_Affected":versions_Affected,
                    "versions_Affected2":versions_Affected2,"cwe":cwe}
            add = {'cwe':cwe}
            df = pd.DataFrame(data,columns=["cve_Id","advisory","date","versions_Affected",
                    "versions_Affected2"])
            additional = pd.DataFrame(add,columns=['cwe'])
            now = pd.concat([df, additional], axis=1)
            writer = ExcelWriter("curl"+".xlsx")
            now.to_excel(writer,'CVE Details',index=False)
            writer.save()

        except Exception as e:
            print("type error: " + str(e))

        pass
