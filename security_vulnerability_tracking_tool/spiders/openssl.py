# -*- coding: utf-8 -*-
import scrapy
import pandas as pd
from pandas import ExcelWriter

class OpensslSpider(scrapy.Spider):
    name = 'openssl'
    allowed_domains = ['www.openssl.org/news/vulnerabilities-1.0.2.html']
    start_urls = ['https://www.openssl.org/news/vulnerabilities-1.0.2.html']

    def parse(self, response):
        impact_Rating= response.xpath('//dl/dt/a[3]').re('.*?\#(.*)?"')
        cve_Id  = response.xpath('//dt/a[contains(text(), "CVE-")]/text()').extract()
        advisory= response.xpath('//*[@id="content"]/div/article/div/dl/dd/text()').extract()
        affected=response.xpath('//dd/ul/li[contains(text(),"1.0.2")]').extract()
        #affected=response.xpath('//*[@id="content"]/div/article/div/dl/dd/ul/li/text()[2]').extract()
        try:
            data = {'impact_Rating':impact_Rating,'Advisory':advisory,"CVE-Id":cve_Id ,"versions_Affected":affected
                     }
            df = pd.DataFrame(data,columns=["impact_Rating","CVE-Id","Advisory",
                    "versions_Affected"])
            writer = ExcelWriter("openssl"+".xlsx")
            #print(len(affected))
            df.to_excel(writer,'CVE Details',index=False)
            writer.save()

        except Exception as e:
            print("type error: " + str(e))


    pass
