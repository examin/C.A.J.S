# -*- coding: utf-8 -*-
import scrapy
import pandas as pd
from pandas import ExcelWriter

class Tomcat8Spider(scrapy.Spider):
    name = 'Tomcat_8'
    allowed_domains = ['tomcat.apache.org/security-8.html']
    start_urls = ['https://tomcat.apache.org/security-8.html']

    def parse(self, response):
        impact_Rating = response.xpath('//*[@id="content"]/div/p/strong/text()').re('^[LIM]')
        advisory = response.xpath('//*[@id="content"]/div/p/strong/text()').re(': .*')
        cve_Id  =response.xpath('//h3/a/text()').extract()
        versions_Affected=response.xpath('//tr/td[contains(text(), "2.")]/text()').extract()


        modified_Impact_name=[]
        for item in impact_Rating:
            if item == 'L':
                item = 'low'
            if item == 'I':
                item = 'important'
            if item == 'M':
                item = 'moderate'
            if item == 'n':
                item = 'n/a'
            modified_Impact_name.append(item)
        impact_Rating=modified_Impact_name
        print("impact rating")
        print(len(impact_Rating))
        print("cve")
        print(len(cve_Id))
        print("advisory")
        print(len(advisory))
        try:
            data = {'impact_Rating':impact_Rating,'Advisory':advisory,"CVE-Id":cve_Id ,"versions_Affected":versions_Affected
                     }
            df = pd.DataFrame(data,columns=['impact_Rating','Advisory'])
            writer = ExcelWriter("Tomcat_8"+".xlsx")
            print(writer)
            df.to_excel(writer,'CVE Details',index=False)
            writer.save()

        except Exception as e:
            print("type error: " + str(e))

        pass
